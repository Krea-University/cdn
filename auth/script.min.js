/*Krea SSO @2021 |Copyright The Closure Library Authors.|SPDX-License-Identifier: Apache-2.0| AUTHOR - SENTHIL NASA*/
var getx=function(e){if(""==e)return{};for(var t={},i=0;i<e.length;++i){var o=e[i].split("=",2);1==o.length?t[o[0]]="":t[o[0]]=decodeURIComponent(o[1].replace(/\+/g," "))}return t}(window.location.search.substr(1).split("&"));const client_id=getx.client_id,redirect_uri=getx.redirect_uri;function check(e){for(i=0;i<e.length;i++)(null==e[i]||null==e[i]||" "==e[i]||""==e[i])&&window.location.replace("../403/")}var Gtoken;check([client_id,redirect_uri]);const tab=document.querySelector(".container");function loginView(){tab.className="container staff"}function resetView(){tab.className="container reset"}function loader(e=!0){e?$("#loader").addClass("active"):$("#loader").removeClass("active")}function otpShow(e=!0){e?$("#otp").addClass("active"):$("#otp").removeClass("active")}function passwordShow(e=!0){e?$("#password").addClass("active"):$("#password").removeClass("active")}function toast(e){$("#toast").removeClass("show"),$("#toast").text(e),$("#toast").addClass("show"),setTimeout((function(){$("#toast").removeClass("show")}),3e3)}firebase.initializeApp({apiKey:document.querySelector('meta[name="fApiKey"]').content}),$(document).ready((function(){setTimeout((function(){loader(0)}),1500)}));var token="";function setToken(e){if(token=e,setTimeout((function(){submitToken()}),500),isValidHttpUrl(redirect_uri))return submitToken(),void loader(1);submitToken(),tab.className="container"}function isValidHttpUrl(e){let t;try{t=new URL(e)}catch(e){return!1}return"http:"===t.protocol||"https:"===t.protocol}function submitToken(){window.location.replace(redirect_uri+"?token="+token),closeTab()}var googleUser={};function makegSign(){var e=(({url:e,title:t,w:i,h:o})=>{const n=void 0!==window.screenLeft?window.screenLeft:window.screenX,r=void 0!==window.screenTop?window.screenTop:window.screenY,a=window.innerWidth?window.innerWidth:document.documentElement.clientWidth?document.documentElement.clientWidth:screen.width,s=window.innerHeight?window.innerHeight:document.documentElement.clientHeight?document.documentElement.clientHeight:screen.height,c=a/window.screen.availWidth,d=(a-i)/2/c+n,l=(s-o)/2/c+r,u=window.open(e,t,`\n          scrollbars=yes,\n          width=${i/c}, \n          height=${o/c}, \n          top=${l}, \n          left=${d}\n          `);return window.focus&&u.focus(),u})({url:"oauthHandler?client_id="+client_id+"&redirect_uri="+redirect_uri,title:"Erp Authentication System !",w:500,h:500});window.addEventListener("message",(function(e){var i=JSON.parse(e.data);i.ok?setToken(i.data):toast(i.error),clearInterval(t)}),!1);var t=setInterval((function(){(null==e||e.closed)&&(clearInterval(t),toast("Google Signin Closed by User !"))}),500)}function ajax(e,t={},i=(e=>{}),o=(()=>{})){$.ajax({url:e,type:"POST",data:JSON.stringify(t),processData:!1,contentType:"application/json; charset=UTF-8",dataType:"json",success:e=>{!0===e.ok?i(e.data):(403==e["err-code"]&&window.location.replace("../403/"),toast(e["err-msg"]),o())},error:(e,t,i)=>{toast(t),o()}})}function resetReCaptcha(){"undefined"!=typeof grecaptcha&&void 0!==window.recaptchaWidgetId&&grecaptcha.reset(window.recaptchaWidgetId)}window.recaptchaVerifier=new firebase.auth.RecaptchaVerifier("sendOtp",{size:"invisible",callback:function(e){loader(1),sendOtp(e)}}),window.recaptchaVerifier.render().then((function(e){window.recaptchaWidgetId=e}));var input=document.querySelector("#mobile"),iti=window.intlTelInput(input,{initialCountry:"in",utilsScript:"https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/js/utils.js",autoPlaceholder:"polite"});function sendOtp(e){var t=$("#passwordReset").serializeArray(),i={};$.map(t,(function(e,t){i[e.name]=e.value})),i.client_id=client_id,i.redirect_uri=redirect_uri,i.token=e,i.mobile=iti.getNumber();resetReCaptcha(),ajax("../Auth/api/doGetOtp",i,(e=>{$("#sssid").val(e),loader(0),passwordShow()}),(()=>{loader(0)}))}function resendOtp(){$("#passwordReset").submit()}function closeTab(){setTimeout((function(){window.close()}),1e5)}if($("#passwordReset").submit((function(e){e.preventDefault(),$("#sendOtp").click()})),$("#otpSubmit").submit((function(e){if(e.preventDefault(),$("#new_pass").val()==$("#re_new_pass").val()){passwordShow(0),loader(1);var t=$("#otpSubmit").serializeArray(),i={};$.map(t,(function(e,t){i[e.name]=e.value})),i.client_id=client_id,i.redirect_uri=redirect_uri;ajax("./api/doVerifyOtp",i,(e=>{alert("Password Updated Sucessfully"),window.location.reload(1)}),(()=>{loader(0),passwordShow(1)}))}else toast("Both Password Should be same !")})),navigator&&navigator.userAgent){var t=navigator.userAgent.match(/opera|chrome|safari|firefox|msie|trident(?=\/)/i);t&&t[0].search(/trident|msie/i)<0&&(window.console.log("%cSTOP!","color:red;font-size:xx-large;font-weight:bold;"),window.console.log("%cThis is a browser feature intended for developers. Do not enter or paste code which you don't understand. It may allow attackers to steal your information or impersonate you.\nSee https://en.wikipedia.org/wiki/Self-XSS for more details","font-size:large;"))}else window.console.log("STOP!\nThis is a browser feature intended for developers. Do not enter or paste code which you don't understand. It may allow attackers to steal your information or impersonate you.\nSee https://en.wikipedia.org/wiki/Self-XSS for more details");